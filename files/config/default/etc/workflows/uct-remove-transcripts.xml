<?xml version="1.0" encoding="UTF-8" ?>
<definition xmlns="http://workflow.opencastproject.org">

  <id>uct-remove-transcripts</id>
  <title>Remove Transcripts</title>
  <tags>
    <tag>archive</tag>
  </tags>
  <description>Remove transcripts from event</description>
  <configuration_panel>
    <![CDATA[
      <div id="workflow-configuration">
        <fieldset>
          <legend>Remove transcript:</legend>
          <ul>
            <li>
              <input id="googleTranscript" name="googleTranscript" type="checkbox" checked="checked" class="configField" value="true" />
              <label for="googleTranscript">Remove google transcript</label>
            </li>
            <li>
              <input id="nibityTranscript" name="nibityTranscript" type="checkbox" checked="checked" class="configField" value="true" />
              <label for="nibityTranscript">Remove nibity transcript</label>
            </li>
            <li>
              <input id="uploadedTranscript" name="uploadedTranscript" type="checkbox" checked="checked" class="configField" value="true" />
              <label for="uploadedTranscript">Remove uploaded transcript</label>
            </li>
          </ul>
        </fieldset>
      </div>
    ]]>
  </configuration_panel>

  <operations>

    <!-- Defaults -->
    <operation
        id="defaults"
        description="Applying default configuration values">
      <configurations>
        <configuration key="googleTranscript">false</configuration>
        <configuration key="nibityTranscript">false</configuration>
        <configuration key="uploadedTranscript">false</configuration>
      </configurations>
    </operation>

    <!-- Remove google transcript -->
    <operation
      id="retract-engage"
      fail-on-error="true"
      if="${googleTranscript}"
      exception-handler-workflow="partial-error"
      description="Retract google transcript from event">
      <configurations>
        <configuration key="retract-flavors">captions/timedtext</configuration>
      <configurations>
    </operation>

    <operation
      id="retract-engage"
      fail-on-error="true"
      if="${nibityTranscript}"
      exception-handler-workflow="partial-error"
      description="Retract google nibity from event">
      <configurations>
        <configuration key="retract-flavors">captions/vtt</configuration>
      <configurations>
    </operation>

    <operation
      id="retract-engage"
      fail-on-error="true"
      if="${uploadedTranscript}"
      exception-handler-workflow="partial-error"
      description="Retract uploaded transcript from event">
      <configurations>
        <configuration key="retract-flavors">text/vtt</configuration>
      <configurations>
    </operation>

    <!-- Clean up work artifacts -->
    <operation
      id="cleanup"
      fail-on-error="false"
      description="Cleaning up - remove temp processing artifacts">
      <configurations>
        <configuration key="delete-external">false</configuration>
        <!-- FixMe Don't clean up ACLs until workflow service no longer looks for them in the WFR. -->
        <configuration key="preserve-flavors">dublincore/*,security/*</configuration>
        <configuration key="delay">5</configuration>
      </configurations>
    </operation>

  </operations>

</definition>
